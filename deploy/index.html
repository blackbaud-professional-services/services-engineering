<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="CnvHeaderVersion" content="v5.0"/><title data-react-helmet="true">Build | Services Engineering</title><link rel="stylesheet" href="/services-engineering/main-f3fa57c86fd65da14e38.css"/><link href="https://fonts.googleapis.com/css?family=Montserrat:400,900" rel="stylesheet"/><style>.cxsync-279093126{display:flex;align-items:stretch;justify-content:flex-start;min-height:100vh;color:#444;font-family:Montserrat, Arial, sans-serif}.cxsync-2249242545{flex:0 0 15rem;padding:3rem 1.5rem;background-color:#F4F4F4}.cxsync-2957022663{flex:1;padding:3rem;max-width:60rem}.cxsync-3751804845{}.cxsync-3751804845 ul{margin:-1.5rem}.cxsync-3751804845 li{margin:1.5rem}.cxsync-2423527651{font-family:Montserrat, Arial, sans-serif;font-weight:900}.cxsync-1263781436{margin-bottom:1.5rem}.cxsync-324972854{font-family:Montserrat, Arial, sans-serif;font-weight:900;font-size:2.48832rem;margin-top:1.5rem;margin-bottom:1.5rem}.cxsync-324972854:first-child{margin-top:0px}.cxsync-2590042826{}.cxsync-2590042826 h1{padding:3rem 0 1.5rem}.cxsync-2590042826 h2{padding:3rem 0 1.5rem}.cxsync-2590042826 h3{padding:3rem 0 1.5rem}.cxsync-2590042826 a{opacity:0.75;border-bottom:2px solid #8BBF47;transition:ease-out .25s}.cxsync-2590042826 a:hover{opacity:1}.cxsync-2590042826 .highlight{background-color:#E7F2D9}.cxsync-137111509{font-family:Montserrat, Arial, sans-serif}.cxsync-137111509 p{padding-bottom:1.5rem;line-height:1.5}.cxsync-137111509 ul{list-style-type:disc;list-style-position:outside;padding-bottom:1.5rem;line-height:1.5}.cxsync-137111509 ol{list-style-type:decimal;list-style-position:outside;padding-bottom:1.5rem;line-height:1.5}.cxsync-137111509 li{margin-left:1.5rem}.cxsync-137111509 blockquote{max-width:37.5rem;padding-bottom:1.5rem;margin:0 auto;text-align:center;line-height:1.5;font-weight:700;font-size:1.2rem}.cxsync-137111509 blockquote:before{content:open-quote}.cxsync-137111509 blockquote:after{content:close-quote}.cxsync-137111509 img{display:block;margin:0 auto;width:auto;max-width:100%}.cxsync-137111509 iframe{padding-bottom:3rem}.cxsync-137111509 strong{font-weight:700}.cxsync-137111509 em{font-style:italic}.cxsync-137111509 h1{font-family:Montserrat, Arial, sans-serif;font-weight:900;font-size:2.0736rem;padding-bottom:1.5rem;padding:3rem 0 1.5rem}.cxsync-137111509 h2{font-family:Montserrat, Arial, sans-serif;font-weight:900;font-size:1.728rem;padding-bottom:1.5rem;padding:3rem 0 1.5rem}.cxsync-137111509 h3{font-family:Montserrat, Arial, sans-serif;font-weight:900;font-size:1.44rem;padding-bottom:1.5rem;padding:3rem 0 1.5rem}.cxsync-137111509 h4{font-family:Montserrat, Arial, sans-serif;font-weight:900;font-size:1.2rem;padding-bottom:1.5rem}.cxsync-137111509 h5{font-family:Montserrat, Arial, sans-serif;font-weight:900;font-size:1rem;padding-bottom:1.5rem}.cxsync-137111509 h6{font-family:Montserrat, Arial, sans-serif;font-weight:900;font-size:0.8333333333333334rem;padding-bottom:1.5rem}.cxsync-137111509 a{opacity:0.75;border-bottom:2px solid #8BBF47;transition:ease-out .25s}.cxsync-137111509 a:hover{opacity:1}.cxsync-137111509 .highlight{background-color:#E7F2D9}.cxsync-2282092937{position:relative;margin-top:0.75rem;margin-bottom:1.5rem;padding:0.75rem 1.5rem;background-color:#F4F4F4;font-size:0.8333333333333334rem;line-height:1.75}.cxsync-4258600099{position:absolute;bottom:100%;right:0px;padding:0.375rem 0.75rem;background-color:#F4F4F4;font-size:0.6944444444444444rem}</style><script>
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-PN6K34');</script></head><body><main id="mount"><div class="cxsync-279093126" data-reactroot="" data-reactid="1" data-react-checksum="762435987"><aside class="cxsync-2249242545" data-reactid="2"><nav class="cxsync-3751804845" data-reactid="3"><ul data-reactid="4"><li data-reactid="5"><a href="/services-engineering/" data-reactid="6">Overview</a></li><li data-reactid="7"><a href="/services-engineering/getting-started" data-reactid="8">Getting Started</a></li><li data-reactid="9"><a href="/services-engineering/components" data-reactid="10">Components</a></li><li data-reactid="11"><a href="/services-engineering/routing" data-reactid="12">Routing</a></li><li data-reactid="13"><a href="/services-engineering/state" data-reactid="14">State</a></li><li data-reactid="15"><a href="/services-engineering/styles" data-reactid="16">Styles</a></li><li data-reactid="17"><a href="/services-engineering/content" data-reactid="18">Content</a></li><li data-reactid="19"><a href="/services-engineering/integration" data-reactid="20">Integration</a></li><li data-reactid="21"><a href="/services-engineering/tests" data-reactid="22">Tests</a></li><li data-reactid="23"><a href="/services-engineering/build" data-reactid="24">Build</a></li><li data-reactid="25"><a href="/services-engineering/deploy" class="cxsync-2423527651" data-reactid="26">Deploy</a></li></ul></nav></aside><section class="cxsync-2957022663" data-reactid="27"><div data-reactid="28"><!-- react-empty: 29 --><h2 class="c11n-heading cxsync-324972854" data-reactid="30">Build</h2><div class="c11n-rich-text cxsync-137111509" data-reactid="31"><h3 data-reactid="32">Targets</h3><p data-reactid="33">Boiler Room Builder has a deploy script that works with 3 different targets.</p><ul data-reactid="34"><li data-reactid="35"><span class="highlight" data-reactid="36">gh-pages</span><!-- react-text: 37 -->: deploys a site to Github Pages<!-- /react-text --></li><li data-reactid="38"><span class="highlight" data-reactid="39">s3</span><!-- react-text: 40 -->: AWS S3<!-- /react-text --></li><li data-reactid="41"><span class="highlight" data-reactid="42">lamdba</span><!-- react-text: 43 -->: AWS Lambda<!-- /react-text --></li></ul><h3 data-reactid="44">Github Pages</h3><p data-reactid="45">We often use Github pages for staging. We would first run a staging build of our app, and then use a BRB script to deploy that staging build to Github Pages.</p><p data-reactid="46"><!-- react-text: 47 -->It basically works by committing your statically built site to a <!-- /react-text --><span class="highlight" data-reactid="48">gh-pages</span><!-- react-text: 49 --> branch in your repository, which Github then hosts for us at a url like <!-- /react-text --><span class="highlight" data-reactid="50">https://everydayhero.github.io/repo-name</span></p><p data-reactid="51"><!-- react-text: 52 -->You might remember we spoke about our <!-- /react-text --><span class="highlight" data-reactid="53">BASE_PATH</span><!-- react-text: 54 --> during the build step, and this is the example of when we would want to set that, to ensure our app works correctly being served from a subdirectory.<!-- /react-text --></p><div class="cxsync-2282092937" data-reactid="55"><span class="cxsync-4258600099" data-reactid="56">shell</span><pre data-reactid="57"><code data-reactid="58">brb deploy --target=gh-pages</code></pre></div><h3 data-reactid="59">S3</h3><p data-reactid="60">For hosting our static sites in production, we use S3. We would first run a production build of our app, and then use a BRB script to deploys the files to S3.</p><p data-reactid="61">Deploying to S3 requires AWS credentials information to be available as environment variables. This can be ahieved in many ways, with AWS Vault being the most common.</p><div class="cxsync-2282092937" data-reactid="62"><span class="cxsync-4258600099" data-reactid="63">shell</span><pre data-reactid="64"><code data-reactid="65">brb deploy --target=s3 --bucket=bucket-name --prefix=domain</code></pre></div><h5 data-reactid="66">blackbaud-sites.com</h5><p data-reactid="67"><!-- react-text: 68 -->For small sites not requiring a custom domain, we can deploy these into a folder within <!-- /react-text --><span class="highlight" data-reactid="69">blackbaud-sites</span><!-- react-text: 70 --> bucket. If the folder name matches a subdomain of blackbaud-sites.com, the site will automatically work with SSL enabled e.g. my-site.blackbaud-sites.com.<!-- /react-text --></p><h5 data-reactid="71">Custom Domains</h5><p data-reactid="72"><!-- react-text: 73 -->For custom domains, we would deploy to the <!-- /react-text --><span class="highlight" data-reactid="74">blackbaud-professional-services-production</span><!-- react-text: 75 --> bucket, in a folder that shares a name with the domain of the site.<!-- /react-text --></p><p data-reactid="76">The next steps are requesting an SSL certificate via Certificate Manager for the domain, and then configuring a Cloudfront distribution which points to our folder.</p><p data-reactid="77">We can then pass on the details to the client to do the necessary configuration i.e. create an alias for their domain pointing to the Cloudfront url.</p><h3 data-reactid="78">Lambda</h3><p data-reactid="79">For sites that require dynamic routes, we can deploy them to Lambda. This method creates a Lambda, uploads it to S3, and creates a Cloudformation script that configures API Gateway and sets up our lambda.</p><p data-reactid="80">Any requests to the site will be forwarded to the Lambda, which is running our app, and will return dynamically generated HTML, as opposed to the statically generated HTML we were using in the earlier methods.</p><p data-reactid="81">Configuring a domain name for these sites requires similar steps to above i.e. an SSL certificate and Cloudfront distribution.</p><div class="cxsync-2282092937" data-reactid="82"><span class="cxsync-4258600099" data-reactid="83">shell</span><pre data-reactid="84"><code data-reactid="85">brb deploy --target=lambda --bucket=bucket-name --fn-name=myAppNameProd</code></pre></div><h3 data-reactid="86">Automating via Buildkite</h3><p data-reactid="87">Our app is setup to build and deploy from the command line, but usually, we want to automate this using a CI tool, in our case Buildkite. We do this for a couple of reasons:</p><ul data-reactid="88"><li data-reactid="89">Deploying manually is prone to mistakes</li><li data-reactid="90">Eliminates the need for us to have active AWS credentials on our machines</li></ul><p data-reactid="91">When Boilermaker generated our app, it would have included the necessary files that will be used by Buildkite to make up our pipeline.</p><ul data-reactid="92"><li data-reactid="93"><span class="highlight" data-reactid="94">.buildkite/pipeline.yml</span><!-- react-text: 95 -->: these are the steps of our pipeline<!-- /react-text --></li><li data-reactid="96"><span class="highlight" data-reactid="97">bin/test and bin/deploy</span><!-- react-text: 98 -->: these are the actual scripts that the pipeline will execute<!-- /react-text --></li><li data-reactid="99"><span class="highlight" data-reactid="100">docker-compose.yml</span><!-- react-text: 101 -->: details of the docker container our app will run in<!-- /react-text --></li></ul><p data-reactid="102">To create the pipeline in Buildkite, we need to do a few steps.</p><ul data-reactid="103"><li data-reactid="104">Login using the credentials in 1Password</li><li data-reactid="105">Create a new pipeline specifying the name and Github repo of our project</li><li data-reactid="106"><!-- react-text: 107 -->Add the necessary environment variables, which include the <!-- /react-text --><span class="highlight" data-reactid="108">APP_NAME</span><!-- react-text: 109 --> and the necessary AWS credentials.<!-- /react-text --></li><li data-reactid="110"><!-- react-text: 111 -->Tell Buildkite to look at our pipeline config in our codebase, by adding <!-- /react-text --><span class="highlight" data-reactid="112">buildkite-agent pipeline upload</span></li><li data-reactid="113">Configure our Github webhooks following the necessary instructions</li></ul><p data-reactid="114">And that&#x27;s it, when our repo is updated, the pipeline will run the tests, and deploy to staging and production. Although Boilermaker gives us a good baseline, we can configure our pipeline as needed.</p><h3 data-reactid="115">Prismic Webhooks</h3><p data-reactid="116">The last thing we may wish to do is configure Prismic to trigger a Buildkite build to re-deploy the site when changes are made in the CMS.</p><p data-reactid="117"><!-- react-text: 118 -->This uses by adding a Prismic webhook that will notify <!-- /react-text --><a href="https://github.com/everydayhero/soundwave" data-reactid="119">Soundwave</a><!-- react-text: 120 -->, which is an small internal app that listens to webhooks and triggers builds.<!-- /react-text --></p><p data-reactid="121">Details of how to configure the webhook can be found in the Soundwave readme.</p></div></div></section></div></main><script id="initial-state" type="application/json">{"blank":{}}</script><script src="/services-engineering/main-f3fa57c86fd65da14e38.js"></script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PN6K34" height="0" width="0" style="display:none;visibility:hidden;"></iframe></noscript></body></html>